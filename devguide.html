<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <title>DIFI - DCAT Harvester</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/jumbotron.css" rel="stylesheet">

    <style>
        li.active {
            text-decoration: underline;
        }
    </style>
</head>

<body data-spy="scroll" data-target="#myScrollspy" data-offset="20">

<nav class="navbar navbar-static-top navbar-dark bg-inverse">
    <a class="navbar-brand" href="index.html">DCAT Harvester</a>
    <ul class="nav navbar-nav">
        <li class="nav-item">
            <a class="nav-link" href="index.html">Front page</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="userguide.html">User guide</a>
        </li>
        <li class="nav-item ">
            <a class="nav-link" href="architecture.html">Architecture</a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" href="devguide.html">Dev guide</a>
        </li>
    </ul>
</nav>


<div class="container">
    <!-- Example row of columns -->


    <div class="row" style="padding-top:20px">


        <div class="col-xs-12 col-md-9  bd-content">
            <h2 id="Modules">Modules</h2>
            <hr style="margin-top: 0px"/>

            <p>There are four main modules in the DCAT Harvester.
            There is one module for user interaction with an API and a frontend. Another module
            caters to the consumers of the data, with RSS feeds and complete RDF export functionality.
            A shared module with the datastore abstractions connects Elasticsearch and Fuseki to the other modules.
                Finally the main module, the actual harvester, downloads DCAT data and validates it before
                storing it in Fuseki and indexing it to Elasticsearch.

            </p>

            <h4 id="dcat-admin-webapp">dcat-admin-webapp</h4>
            <hr style="margin-top: 0px"/>
            <p>Frontend admin interface built with JSP. There are three main views. The admin
            view is used to administer the users. Here you can create, update and delete users.
            The users view is for registering a DCAT source for harvesting and monitoring
            your harvesting status. And then dcat source view is for inspecting a specific
            DCAT source with a history of it's 100 previous harvests and potentially error messages.
            More errors messages are available through Kibana.</p>

            <p>The JSP pages are initiated with controllers found in the dcat and user packages. The controllers load the
            required data and trigger the matching JSP page.</p>

            <p>Requests initiated from the webpage are handled by an API. All request use JSON and
            have matching DTOs in their package.</p>

            <h5>Security</h5>

            <p>Spring security is used to authenticate and authorize users. User information is saved
            in Fuseki. All requests need to be authenticated. Users can manipulate their own data, eg. their DCAT sources,
            while admin users can add and remove other users and also edit their DCAT sources.</p>




            <h4 id="dcat-api-app">dcat-api-app</h4>
            <hr style="margin-top: 0px"/>

            <p>Api for the frontend and also for the RSS feeds and RDF/JSON-LD data.</p>

            <p>The api for retrieving DCAT data from the store is located in "DcatRestController.java" and provides the following functionality.</p>

            <h5>Retrieve all DCAT data</h5>
            <table class="table">
                <thead></thead>
                <tbody>
                <tr>
                    <td>Type</td>
                    <td>GET</td>
                </tr>
                <tr>
                    <td>Path</td>
                    <td>/api/dcat</td>
                </tr>
                <tr>
                    <td>Param</td>
                    <td>format</td>
                </tr>
                <tr>
                    <td>Param value</td>
                    <td>
                        <ul>
                            <li>jsonld</li>
                            <li>rdf/xml</li>
                            <li>application/ld+json</li>
                            <li>application/rdf+xml</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td>Description</td>
                    <td>Get all DCAT data in a single request. Either as JSON-LD or as RDF/XML.</td>
                </tr>

                <tr>
                    <td>Example</td>
                    <td><code>/api/dcat?format=rdf%2Fxml</code></td>
                </tr>

                </tbody>
            </table>


            <h5>Invalidate cache</h5>
            <table class="table">
                <thead></thead>
                <tbody>
                <tr>
                    <td>Type</td>
                    <td>POST</td>
                </tr>
                <tr>
                    <td>Path</td>
                    <td>/api/invalidateCache</td>
                </tr>

                <tr>
                    <td>Description</td>
                    <td>Invalidate the cache for the <code>/api/dcat</code> call.</td>
                </tr>


                </tbody>
            </table>


            <h5>Refresh cache</h5>
            <table class="table">
                <thead></thead>
                <tbody>
                <tr>
                    <td>Type</td>
                    <td>POST</td>
                </tr>
                <tr>
                    <td>Path</td>
                    <td>/api/refreshCache</td>
                </tr>

                <tr>
                    <td>Description</td>
                    <td>Refresh the cache for the <code>/api/dcat</code> call. This call blocks until the cache has been refreshed!</td>
                </tr>


                </tbody>
            </table>
            <p>
                The api to retrieve all the DCAT data can be slow, so there is a simple cache solution to cache all the RDF data.
                The cache solution is in "Application.java" and uses Guava to cache the response from Fuseki. The response is cached in clear text,
                so there will normally be one cache entry per format (eg. JSON-LD and RDF/XML). The cache entries automatically expire every 24 hours.

            </p>


            <p>
             As well as RDF, the api can also output an RSS stream. "FeedController.java" has the following api:
            </p>

            <h5>RSS feed api</h5>
            <table class="table">
                <thead></thead>
                <tbody>
                <tr>
                    <td>Type</td>
                    <td>GET</td>
                </tr>
                <tr>
                    <td>Path</td>
                    <td>/api/rss/feed</td>
                </tr>

                <tr>
                    <td>Description</td>
                    <td>Returns an RSS feed of the DCAT data.</td>
                </tr>


                </tbody>
            </table>

            <h4 id="dcat-datastore">dcat-datastore</h4>
            <hr style="margin-top: 0px"/>

            <p>Module with abstractions over Fuseki and Elasticsearch.</p>

            <p>The <code>AdminDataStore</code> class provides methods for user administaration (except delete user) and DCAT source administration (exception deletion).
                The method for adding a user can also be used for updating users, and there is logic for stopping multiple users having the same username.
                Same goes for adding DCAT sources, however multiple users are allowed to add the same URL for harvesting. This doesn't mean they share the same source.
            </p>

            <p><code>AdminDcatDataService</code> provides delete methods for both DCAT sources and users. When deleting a user, you first have to clean up all the users DCAT sources.</p>

            <p><code>DcatDataStore</code> is the abstraction used for storing the harvested DCAT data from a DCAT source, and also for retrieving said data.</p>

            <p>The <code>Fuseki</code> and <code>Elasticsearch</code> are simple abstractions above Fuseki and Elasticsearch to simplify inserts, updates and deletes.</p>

            <h4 id="dcat-generate-dummy-data">dcat-generate-dummy-data</h4>
            <hr style="margin-top: 0px"/>

            <p>Small stand-alone program for generating test data in DCAT format.</p>

            <h4 id="dcat-harvester-app">dcat-harvester-app</h4>
            <hr style="margin-top: 0px"/>
            <p>Module for harvesting DCAT data from sources.</p>

            <p>The main component of the system, designed to retrieve DCAT data from various sources and incorporate it
            into a single database</p>

            <p>A CrawlerJob is the main process of the harvester. It downloads DCAT data from a specified source, does validation and any
            transformations required before sending it to be Fuseki and Elasticsearch.</p>

            <p>The validation is a set of SPARQL queries that return any invalid data. The queires are available in the resources folder
            under validation-rules/from-eu. The rules are a copied from <a href="https://github.com/EmidioStani/dcat-ap_validator">https://github.com/EmidioStani/dcat-ap_validator</a></p>

            <p>CrawlerJob information is stored in Fuseki, together with user information in the uses database.</p>

            <p>A CrawelJob can be initiated with a request to <code>/api/admin/harvest-all</code> or <code>/api/admin/harvest?id=CRAWLER_ID_HERE</code></p>

            <p>To support data from Vegvesenet and from Entryscape there are two transforms in CrawlerJob. <code>enrichForEntryscape(model)</code> will transform Entryscape data
            and <code>enrichForVegvesenet(model)</code> will transform data from Vegvesenet.</p>

            <h5>XmlToRdf</h5>

            <p>DCAT Catalogs can contain identifiers for corporations and organisations. These identifiers can be looked
            up in the Brønnøysund registers to find the name and other information about the organisations.</p>

            <p>This information is in XML, so to convert it we use XmlToRdf. This is an early version of XmlToRdf, the library
            has since been developed further and released as an open source project: <a href="https://github.com/AcandoNorway/XmlToRdf">https://github.com/AcandoNorway/XmlToRdf</a></p>




            <h2 id="Building-and-running">Building and running</h2>
            <hr style="margin-top: 0px"/>

            <h4>Prerequisits</h4>
            <ul>
                <li>docker</li>
                <li>docker-compose</li>
                <li>a unix operating system (for simplicity, not really a requirement)</li>
                <li>Java 8</li>
                <li>maven >3.3.x</li>
            </ul>

            <p>The easiest and simplest way to build and run the system is to use the command line script <code>./rundocker.sh</code> which will
                build the Java modules, build all the docker images and then start the containers.</p>

            <p>The admin interface should now be available at <a href="http://localhost:8080/dcat-admin-webapp/">http://localhost:8080/dcat-admin-webapp/</a></p>

            <p>The docker setup is not intended for production use.</p>


        </div>


        <div class="col-xs-12 col-md-3 push-md-9 bd-sidebar hidden-print hidden-sm-down" style="position:fixed">


            <nav id="myScrollspy">
                <ul class="nav nav-pills nav-stacked">
                    <li>
                        <a href="#Modules">Modules</a>
                    </li>
                    <li style="margin-left:10px;">
                        <a style="font-size: 0.9em" href="#dcat-admin-webapp">dcat-admin-webapp</a>
                    </li>
                    <li style="margin-left:10px;">
                        <a style="font-size: 0.9em" href="#dcat-api-app">dcat-api-app</a>
                    </li>
                    <li style="margin-left:10px;">
                        <a style="font-size: 0.9em" href="#dcat-datastore">dcat-datastore</a>
                    </li>
                    <li style="margin-left:10px;">
                        <a style="font-size: 0.9em" href="#dcat-generate-dummy-data">dcat-generate-dummy-data</a>
                    </li>
                    <li style="margin-left:10px;">
                        <a style="font-size: 0.9em" href="#dcat-harvester-app">dcat-harvester-app</a>
                    </li>

                    <li>
                        <a href="#Building-and-running">Building and running</a>
                    </li>
                </ul>
            </nav>
        </div>

    </div>


    <hr>

    <footer>
        <p>&copy; DIFI 2016</p>
    </footer>
</div> <!-- /container -->


<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js" integrity="sha384-THPy051/pYDQGanwU6poAc/hOdQxjnOEXzbT+OuUAFqNqFjL+4IGLBgCJC3ZOShY" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.2.0/js/tether.min.js" integrity="sha384-Plbmg8JY28KFelvJVai01l8WyZzrYWG825m+cZ0eDDS1f7d/js6ikvy1+X+guPIB" crossorigin="anonymous"></script>
<script src="js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="js/ie10-viewport-bug-workaround.js"></script>
</body>
</html>
